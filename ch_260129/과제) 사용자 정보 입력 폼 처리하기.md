# 실습과제: 사용자 정보 입력 폼 처리하기

- **1단계**: 브라우저 화면에서 성명과 이메일을 입력받아 서버로 전송하고, 서버가 이를 받아 결과 페이지에 출력하는 기능을 구현합니다. 화면 출력은 EJS 템플릿 엔진을 사용합니다.
- **2단계**: 계속 해서 추가 하면 목록 형식으로 결과가 보여지게 합니다.

---

## 📁 프로젝트 구조

```
project/
  app.js                  # Express 서버 설정 및 라우트 정의
  views/
    form.ejs              # 사용자 입력 폼 (GET /)
    result.ejs            # 결과 출력 페이지 (GET /result)
  package.json            # 프로젝트 메타데이터 및 의존성 관리
```

![image.png](attachment:571a95bd-2b9b-4184-8d69-a721e503c98c:image.png)

---

## 🛠️ 개발 환경 설정

### 1. 프로젝트 초기화

```bash
npm init -y
```

- `package.json` 파일 생성 (프로젝트 메타데이터 및 의존성 관리)

### 2. 의존성 설치

```bash
npm i express cors ejs -D nodemon
```

- **express**: 웹 서버 프레임워크
- **ejs**: 템플릿 엔진 (HTML에 JS 로직 삽입 가능)
- **nodemon**: 코드 변경 시 자동 재시작 (개발용)
- 설치된 리스트 확인
  ```tsx
  npm -S list
  ```

![image.png](attachment:b095ff84-ccc1-4f95-ab7e-a030b710a5ff:image.png)

### 3. 스크립트 추가

```json
"scripts": {
  "dev": "nodemon app.js"
}
```

- `npm run dev` 명령어로 개발 서버 실행
  ```tsx
  npm run dev
  ```
  ![image.png](attachment:960c3505-8ba3-4c5d-8184-e76bf9281081:image.png)

---

## 🧠 `app.js` 서버 로직 설명

```jsx
// 1. Express 모듈 불러오기
const express = require("express");

// 2. Express 앱 인스턴스 생성
const app = express();

// 3. EJS 템플릿 엔진 설정
app.set("views", __dirname + "/views"); // 뷰 폴더 경로
app.set("view engine", "ejs"); // 템플릿 엔진 지정
app.set("port", 3000); // 서버 포트 번호

// 4. 루트 라우트 (폼 페이지)
app.get("/", function (req, res) {
  res.render("form"); // views/form.ejs 렌더링
});

// 5. 사용자 데이터 저장소 (메모리 기반)
var users = [];

// 6. 결과 라우트 (데이터 처리 및 출력)
app.get("/result", function (req, res) {
  // GET 요청 파라미터에서 데이터 추출
  const name = req.query.name;
  const email = req.query.email;

  // 사용자 데이터 저장
  users.push({ name, email });

  // 결과 페이지 렌더링 (데이터 전달)
  res.render("result", { name, email, users });
});

// 7. 서버 시작
app.listen(app.get("port"), () => {
  console.log(`서버 실행 중: <http://localhost>:${app.get("port")}`);
});
```

> 📌 개념 설명
>
> - `req.query`: GET 요청의 쿼리 파라미터 접근
> - `res.render()`: EJS 템플릿에 데이터 전달하여 HTML 생성
> - `users` 배열: 서버 메모리 기반 저장소 (재시작 시 데이터 소멸)

---

## 📄 `form.ejs` - 사용자 입력 폼

```html
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>사용자 입력</title>
  </head>
  <body>
    <h1>사용자 정보 입력</h1>
    <form action="/result" method="get">
      <!-- GET 방식으로 /result로 데이터 전송 -->
      이름:
      <input
        name="name"
        type="text"
        placeholder="이름을 입력하세요."
      /><br /><br />
      <!-- type="email"로 이메일 형식 검증 -->
      E-Mail:
      <input
        name="email"
        type="email"
        placeholder="이메일을 입력하세요."
      /><br /><br />
      <input type="submit" value="전송" />
    </form>
  </body>
</html>
```

![image.png](attachment:d0666379-7b63-4049-a9c1-db353bbc671b:image.png)

---

## 📄 `result.ejs` - 결과 출력 페이지

```html
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>제출 결과</title>
  </head>
  <body>
    <!-- 홈으로 이동하는 링크 -->
    <a href="/">홈으로</a>

    <h2>현재 사용자 정보</h2>
    <p>
      이름: <%= name %><br />
      이메일: <%= email %>
    </p>

    <h3>전체 사용자 목록</h3>
    <ul>
      <% for (let i = 0; i < users.length; i++) { %>
      <li><%= i + 1 %>. <%= users[i].name %> / <%= users[i].email %></li>
      <% } %>
    </ul>
  </body>
</html>
```

> 📌 EJS 문법 설명
>
> - `<%= %>`: JS 변수/객체를 HTML에 삽입
> - `<% %>`:  조건문/반복문 등 제어 로직 삽입

![image.png](attachment:22189800-773c-4174-91b6-cf8e4450b67e:image.png)

---

### **🧩 Express에서 CORS 사용 방법**

- `CORS`는 **Cross-Origin Resource Sharing**의 약자로, **브라우저의 보안 정책** 중 하나입니다. 서로 다른 도메인(Origin)에서 리소스를 요청할 때 발생하는 문제를 해결하기 위한 HTTP 헤더 기반 메커니즘입니다.
- **프로젝트에서 설치한 `cors` 패키지는 Express 미들웨어로 쉽게 CORS를 설정할 수 있게 합니다:**

```jsx
// app.js
const express = require("express");
const cors = require("cors"); // CORS 미들웨어 임포트

const app = express();

// CORS 허용 설정 (모든 도메인 허용 예시)
app.use(cors());

// 또는 특정 도메인만 허용 예시:
// app.use(cors({ origin: "https://허용할-도메인.com" }));
```

- **주요 개념**
  | 개념               | 설명                                                                          |
  | ------------------ | ----------------------------------------------------------------------------- |
  | **Origin**         | 도메인 + 프로토콜 + 포트 (예: `https://a.com:3000`)                           |
  | **Preflight 요청** | 브라우저가 실제 요청 전에 `OPTIONS` 메서드로 서버의 허용 여부를 확인하는 과정 |
  | **CORS 헤더**      | 서버가 응답에 추가하는 헤더 (예: `Access-Control-Allow-Origin`)               |

> **현재 프로젝트의 `form.ejs`는 동일 도메인에서 동작하므로 CORS 문제가 발생하지 않습니다.**
> 하지만 프론트엔드와 백엔드를 별도 도메인으로 분리할 경우, CORS 설정이 필수적이 됩니다.

---

### **📌 프로젝트 적용 팁**

- CORS는 **브라우저 보안 기능**이므로, Postman이나 서버 간 요청에서는 발생하지 않습니다.
- 개발 환경에서 임시로 모든 도메인 허용(`app.use(cors())`)은 보안 위험이 있으므로, **실제 운영 환경에서는 특정 도메인만 허용**해야 합니다.

---
